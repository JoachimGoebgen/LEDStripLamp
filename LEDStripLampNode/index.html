<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>LED Control</title>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body style="text-align:center;">
    <script src="jscolor.js"></script>
    <script src="colorRect.js"></script>
    <div id="page-wrap">
        <p style="margin-top:250px">
        <table>
            <tr style="text-align: left">
                <td></td>
                <td><button id="colTop" class="btnHor jscolor {width:195, height:200, position:'top', valueElement:null, onFineChange:'setColorAndPost()'}" /></td>
                <td></td>
            </tr>
            <tr style="vertical-align: top">
                <td><button id="colLeft" class="btnVer jscolor {width:195, height:200, position:'left', valueElement:null, onFineChange:'setColorAndPost()'}" /></td>
                <td><canvas id="canvas" width=250 height=250></canvas></td>
                <td><button id="colRight" class="btnVer jscolor {width:195, height:200, position:'right', valueElement:null, onFineChange:'setColorAndPost()'}" /></td>
            </tr>
            <tr style="text-align: left">
                <td></td>
                <td><button id="colBot" class="btnHor jscolor {width:195, height:200, position:'bottom', valueElement:null, onFineChange:'setColorAndPost()'}" /></td>
                <td></td>
            </tr>
        </table>

        <div id="test"></div>
    </div>

    <script>
        function setColorAndPost() {
            var btnLeft = document.getElementById("colLeft");
            var btnRight = document.getElementById("colRight");
            var btnTop = document.getElementById("colTop");
            var btnBot = document.getElementById("colBot");

            var colPickerLeft = btnLeft.jscolor;
            var colPickerRight = btnRight.jscolor;
            var colPickerTop = btnTop.jscolor;
            var colPickerBot = btnBot.jscolor;

            var colStrLeft = "rgb(" + Math.round(colPickerLeft.rgb[0]) + ", " + Math.round(colPickerLeft.rgb[1]) + ", " + Math.round(colPickerLeft.rgb[2]) + ")";
            var colStrRight = "rgb(" + Math.round(colPickerRight.rgb[0]) + ", " + Math.round(colPickerRight.rgb[1]) + ", " + Math.round(colPickerRight.rgb[2]) + ")";
            var colStrTop = "rgb(" + Math.round(colPickerTop.rgb[0]) + ", " + Math.round(colPickerTop.rgb[1]) + ", " + Math.round(colPickerTop.rgb[2]) + ")";
            var colStrBot = "rgb(" + Math.round(colPickerBot.rgb[0]) + ", " + Math.round(colPickerBot.rgb[1]) + ", " + Math.round(colPickerBot.rgb[2]) + ")";

            btnLeft.style.boxShadow = "0px 0px 20px 5px " + colStrLeft;
            btnRight.style.boxShadow = "0px 0px 20px 5px " + colStrRight;
            btnTop.style.boxShadow = "0px 0px 20px 5px " + colStrTop;
            btnBot.style.boxShadow = "0px 0px 20px 5px " + colStrBot;

            document.getElementById("canvas").getContext("2d").rainbowRect(25, 25, 200, 200, "white", colStrTop, colStrRight, colStrBot, colStrLeft);

	    //$.post("http://192.168.178.175:3003/color", {"a":[1,2,3,4,5,6,7,8,9,10,11,12]});
	    $.post(document.URL + 'colors', {
		colArr: [
			colPickerTop.rgb[0], colPickerTop.rgb[1], colPickerTop.rgb[2],
                        colPickerRight.rgb[0], colPickerRight.rgb[1], colPickerRight.rgb[2],
                        colPickerBot.rgb[0], colPickerBot.rgb[1], colPickerBot.rgb[2],
                        colPickerLeft.rgb[0], colPickerLeft.rgb[1], colPickerLeft.rgb[2]
		]
	    });

        }
    </script>

    <script>
        // e is click-event
        function openColorPicker(e) {
            var canvRect = canvas.getBoundingClientRect();
            var dLeft = e.clientX - canvRect.left;
            var dRight = canvRect.right - e.clientX;
            var dBot = canvRect.bottom - e.clientY;
            var dTop = e.clientY - canvRect.top;

            if (dLeft < dRight && dLeft < dTop && dLeft < dBot && dLeft * 5 <= canvRect.width) {
                document.getElementById("colLeft").jscolor.show();
            } else if (dRight < dTop && dRight < dBot && dRight * 5 <= canvRect.width) {
                document.getElementById("colRight").jscolor.show();
            } else if (dTop < dBot && dTop * 5 <= canvRect.height) {
                document.getElementById("colTop").jscolor.show();
            } else if (dBot * 5 <= canvRect.height) {
                document.getElementById("colBot").jscolor.show();
            }
        }
    </script>

    <script>
        function requestPickerColor() {


            var colPickerLeft = document.getElementById("colLeft").jscolor;
            var colPickerRight = document.getElementById("colRight").jscolor;
            var colPickerTop = document.getElementById("colTop").jscolor;
            var colPickerBot = document.getElementById("colBot").jscolor;

            colPickerLeft.rgb[0] = 60;
            colPickerLeft.rgb[1] = 130;
            colPickerLeft.rgb[2] = 0;

            colPickerRight.rgb[0] = 230;
            colPickerRight.rgb[1] = 170;
            colPickerRight.rgb[2] = 0;

            colPickerTop.rgb[0] = 20;
            colPickerTop.rgb[1] = 0;
            colPickerTop.rgb[2] = 40;

            colPickerBot.rgb[0] = 50;
            colPickerBot.rgb[1] = 50;
            colPickerBot.rgb[2] = 90;
            
            var url = document.URL + 'config';
            var jqxhr = $.getJSON(url, function (data) {
                document.getElementById("test").textContent = data['R1'];

		console.log(data['MQTT_COLOR_TOPIC']);

                var colPickerLeft = document.getElementById("colLeft").jscolor;
                var colPickerRight = document.getElementById("colRight").jscolor;
                var colPickerTop = document.getElementById("colTop").jscolor;
                var colPickerBot = document.getElementById("colBot").jscolor;

                colPickerLeft.rgb[0] = data['R1'];
                colPickerLeft.rgb[1] = data['G1'];
                colPickerLeft.rgb[2] = data['B1'];

                colPickerRight.rgb[0] = data['R2'];
                colPickerRight.rgb[1] = data['G2'];
                colPickerRight.rgb[2] = data['B2'];

                colPickerTop.rgb[0] = data['R3'];
                colPickerTop.rgb[1] = data['G3'];
                colPickerTop.rgb[2] = data['B3'];

                colPickerBot.rgb[0] = data['R4'];
                colPickerBot.rgb[1] = data['G4'];
                colPickerBot.rgb[2] = data['B4'];
            });
        }
    </script>

    <script>
        function init() {
            requestPickerColor();
            setColorAndPost();

            var btnLeft = document.getElementById("colLeft");
            var btnRight = document.getElementById("colRight");
            var btnTop = document.getElementById("colTop");
            var btnBot = document.getElementById("colBot");

            var colPickerLeft = btnLeft.jscolor;
            var colPickerRight = btnRight.jscolor;
            var colPickerTop = btnTop.jscolor;
            var colPickerBot = btnBot.jscolor;

            var colStrLeft = "rgb(" + Math.round(colPickerLeft.rgb[0]) + ", " + Math.round(colPickerLeft.rgb[1]) + ", " + Math.round(colPickerLeft.rgb[2]) + ")";
            var colStrRight = "rgb(" + Math.round(colPickerRight.rgb[0]) + ", " + Math.round(colPickerRight.rgb[1]) + ", " + Math.round(colPickerRight.rgb[2]) + ")";
            var colStrTop = "rgb(" + Math.round(colPickerTop.rgb[0]) + ", " + Math.round(colPickerTop.rgb[1]) + ", " + Math.round(colPickerTop.rgb[2]) + ")";
            var colStrBot = "rgb(" + Math.round(colPickerBot.rgb[0]) + ", " + Math.round(colPickerBot.rgb[1]) + ", " + Math.round(colPickerBot.rgb[2]) + ")";

            btnLeft.style.background = colStrLeft;
            btnRight.style.background = colStrRight;
            btnTop.style.background = colStrTop;
            btnBot.style.background = colStrBot;
        }
    </script>




    <script>
        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        ctx.lineWidth = 50;
        ctx.rainbowRect(25, 25, 200, 200, "white", "white", "white", "white", "white");
        canvas.addEventListener('click', openColorPicker);

        window.onload = init;
    </script>
</body>
</html>

